<!DOCTYPE html>
<meta charset="UTF-8">

<script src="js/jquery.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

<html>
    <nav class="navbar-light bg-light">
        <a class="navbar-brand" href="index.html">
            <img src="images/icon.png" width="30" height="30" class="d-inline-block align-top" alt=""> MediQuery MCQ app</a>
    </nav>
    <head>
        <title>MediQuery</title>
    </head>

    <body>
        <div class="container" id="app">
            <div class="jumbotron text-center">
                    <h2> {{ question }}</h2>
                    <br></br>
                    <div class="btn-group-vertical " role="group">
                        <button v-on:click="checkAnswer(answerA)" type="button" class="btn btn-primary" id="answer1"><b>{{ answerA }}</b></button>
                        <button v-on:click="checkAnswer(answerB)" type="button" class="btn btn-success" id="answer2"><b>{{ answerB }}</b></button>
                        <button v-on:click="checkAnswer(answerC)" type="button" class="btn btn-danger" id="answer3"><b>{{ answerC }}</b></button>
                        <button v-on:click="checkAnswer(answerD)" type="button" class="btn btn-warning" id="answer4"><b>{{ answerD }}</b></button>
                    </div>
                    <br></br>
                    <div class="btn-group-horizontal" role="group">
                        <button v-on:click="next()" type="button" class="btn btn-outline-success btn-lg" id="nextButton" disabled>Next</button>
                    </div>
            </div>
        </div>
        <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-firestore.js"></script>

        <!--
            START : VueJS scripting
        -->
        <script>
            //Database queries
            let firebaseConfig = {
                apiKey: "AIzaSyDrHxIx-NJh8LxhNa1jw9zu1Y6EZOdv4Kk",
                authDomain: "mediquery-430f7.firebaseapp.com",
                databaseURL: "https://mediquery-430f7.firebaseio.com",
                projectId: "mediquery-430f7",
                storageBucket: "mediquery-430f7.appspot.com",
                messagingSenderId: "313300086775",
                appId: "1:313300086775:web:7e5cffa97977da38bbc8f2",
                measurementId: "G-KS13F48QGP"
            };

            firebase.initializeApp({
                apiKey: firebaseConfig.apiKey,
                authDomain: firebaseConfig.authDomain,
                projectId: firebaseConfig.projectId
            });

            let db = firebase.firestore();
            let level = sessionStorage.getItem('level');
            let type = sessionStorage.getItem('TestType');
            let size = sessionStorage.getItem('TestSize');
            let index = 0;
            let dataArray = [];
            let correctAnswers = 0;
            
            db.collection(level.toString()).limit(size).get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    dataArray.push(doc.data());
                    console.log("DOC ID: " + doc.id);
                });
                var app = new Vue({
                el: '#app',
                data: {
                    question: dataArray[index].question,
                    answerA: dataArray[index].answer1,
                    answerB: dataArray[index].answer2,
                    answerC: dataArray[index].answer3,
                    answerD: dataArray[index].answer4
                },
                methods: {
                    checkAnswer : function (answer) {
                        document.getElementById("nextButton").disabled = false;
                        if (answer === dataArray[index].correct)
                        {
                            console.log("Correct answer");
                            correctAnswers++;
                        }
                        else
                        {
                            console.log("Incorrect answer");
                        }
                    },
                    next : function () {
                        if (index < dataArray.length - 1)
                        {
                            index++;
                            this.question = dataArray[index].question;
                            this.answerA = dataArray[index].answer1;
                            this.answerB = dataArray[index].answer2;
                            this.answerC = dataArray[index].answer3;
                            this.answerD = dataArray[index].answer4;
                            document.getElementById("nextButton").disabled = true;
                        }
                        else
                        {
                            console.log("User scored: " + correctAnswers + "/" + dataArray.length);
                            alert("User scored: " + correctAnswers + "/" + dataArray.length);
                        }
                    }
                }
            })
            })
            .catch((error) => {
                console.log("Error querying database - QuizPage.html", error);
                return null;
            });
            

            /*
            if (type == "Category")
            {

            }
            else
            {
                if (size == 20)
                {

                }
                else
                {

                }
            }
            */
        </script>
        <!--
            END : VueJS scripting
        -->
    </body>
</html>